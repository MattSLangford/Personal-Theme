{{ define "main" }}
<div class="posts-archive">
  <h1 class="archive-title">{{ .Title }}</h1>
  
  {{ with .Content }}
    <div class="microblog_category_intro">{{ . }}</div>
  {{ end }}
  
  <div class="posts h-feed">
    <div class="post_list" role="main">
      {{ $paginator := .Paginate .Pages }}
      {{ range .Paginator.Pages }}
      <article class="post-preview h-entry {{ range .Params.categories }} {{ . | urlize | lower }}{{ end }}{{ if not .Title }} untitled-post{{ end }}">
        <header class="post-header">
          <a href="{{ .Permalink }}" class="post-date u-url"><time class="dt-published" datetime="{{ .Date.Format "2006-01-02 15:04:05 -0700" }}">{{ .Date.Format "2 Jan 2006" }}</time></a>
        </header>
        
        {{ if .Title }}
          <h2 class="post-title p-name"><a href="{{ .Permalink }}">{{ .Title }}</a></h2>
          {{ if in .RawContent "<!--more-->" }}
            <div class="p-summary">
              {{ $splitContents := split .RawContent "<!--more-->" }}
              {{ $summary := index $splitContents 0 }}
              {{ $summary := replaceRE "\\[\\^.*?\\]" "" $summary }}
              {{ $summary := replaceRE "\\n\\[\\^.*?\\]:.*" "" $summary }}
              {{ $summary | markdownify }}
              <p><a class="read-more" href="{{ .Permalink }}">Read More →</a></p>
            </div>
          {{ else if .Params.custom_summary }}
          <div class="p-summary">
            <p>{{ .Summary | safeHTML }}</p>
          </div>
          {{ else }}
            <div class="e-content">
              {{ .Content }}
            </div>
          {{ end }}
        {{ else }}
          <div class="e-content">
            {{ .Content }}
          </div>
        {{ end }}
        
        {{ if .Params.categories }}
        <ul class="post-tags">
          {{ range .Params.categories }} {{ $href := print (absURL "categories/") (urlize .) }}
          <li><a href="{{ $href }}">#{{ . }}</a></li>
          {{ end }}
        </ul>
        {{ end }}
      </article>
      {{ end }}
    </div>
  </div>
  
  <nav class="post-nav">
    {{ if $paginator.HasPrev }}
    <a href="{{ $paginator.Prev.URL }}" title="Previous Page" class="prev">← Newer Posts</a>
    {{ end }}
    {{ if $paginator.HasNext }}
    <a href="{{ $paginator.Next.URL }}" class="next">Older Posts →</a>
    {{ end }}
  </nav>
</div>
{{ end }}